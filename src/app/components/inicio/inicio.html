
@if (loading) {
  <div class="loader-container">
    <p-progress-spinner strokeWidth="6" class="custom-spinner" aria-label="Cargando"></p-progress-spinner>
    <span class="loader-label">Cargando archivo...</span>
  </div>
}

<p-fileUpload
  name="xlsx"
  accept=".xlsx"
  mode="basic"
  auto="true"
  (onSelect)="onFileSelect($event)"
  chooseLabel="Seleccionar archivo XLSX">
</p-fileUpload>

@if (sheetData.length > 0) {
  <p>Vista previa:</p>
  <table class="p-datatable">
    @for (row of sheetData.slice(headerRowIndex, headerRowIndex + 10); let r = $index; track r) {
      <tr>
        @for (cell of row; let c = $index; track c) {
          <td>{{ cell }}</td>
        }
        <td>
          @if (r === 0) {
            <b>(Posible encabezado)</b>
          }
        </td>
      </tr>
    }
  </table>

  <div>
    <label>Fila del encabezado:</label>
    <input type="number" [(ngModel)]="headerRowIndex" min="0" [max]="sheetData.length - 1" (change)="onHeaderRowChange()" />
  </div>

  <div class="selectors">
    <label>
      Eje X:
      <select [(ngModel)]="colX" (change)="onColumnChange()">
        @for (col of columnOptions; track col.value) {
          <option [value]="col.value">{{ col.label }}</option>
        }
      </select>
    </label>
    <label>
      Eje Y:
      <select [(ngModel)]="colY" (change)="onColumnChange()">
        @for (col of columnOptions; track col.value) {
          <option [value]="col.value">{{ col.label }}</option>
        }
      </select>
    </label>
  </div>

  @if (chartData) {
    <p-chart type="line" [data]="chartData" [options]="chartOptions" class="h-[30rem]" />
  }

  @if (correlation !== null && regression) {
    <div class="info-panel">
      <p><b>Correlación:</b> {{ correlation | number:'1.3-3' }}</p>
      <p><b>Regresión lineal:</b> y = {{ regression.slope | number:'1.3-3' }} x + {{ regression.intercept | number:'1.3-3' }}</p>
    </div>
  }
}
